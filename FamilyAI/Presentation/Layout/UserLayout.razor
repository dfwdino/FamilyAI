@page "/UserLayout"
@page "/UserLayout/{ThreadId:int}"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization


@inject AuthenticationStateProvider AuthenticationStateProvider

@inject NavigationManager NavigationManager

@rendermode InteractiveServer


<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        overflow-x: hidden;
    }

    #sidebar {
        min-width: 200px;
        max-width: 500px;
        width: 250px;
        background-color: #212529;
        min-height: 100vh;
        transition: margin-left 0.3s;
    }

        #sidebar .nav-link {
            color: #fff;
            padding: 10px 20px;
        }

            #sidebar .nav-link:hover {
                background-color: #495057;
            }

    #content {
        flex-grow: 1;
        padding: 20px;
    }

    .resizer {
        width: 5px;
        cursor: ew-resize;
        background-color: #dee2e6;
        position: relative;
    }

        .resizer:hover {
            background-color: #0d6efd;
        }

    .container-fluid {
        display: flex;
        padding: 0;
    }
</style>

<CascadingAuthenticationState>
    <AuthorizeView Roles="Admin">
        <Authorized>
<div class="container-fluid">
        <!-- Sidebar -->
        <nav id="sidebar">
            <div class="p-3">
                <h4 class="text-white">Menu</h4>
            </div>
            <FamilyAI.Presentation.User.Menu />
        </nav>

    <div class="resizer" id="resizer"></div>

    <!-- Main Content -->
    <main id="content">
        <div class="mt-4">
    @*         <FamilyAI.Presentation.User.Main /> *@
                        <FamilyAI.Presentation.Pages.Chat ThreadId=@ThreadId />
        </div>
    </main>
</div>
        </Authorized>
        <NotAuthorized>
            <div style="text-align: center; margin-top: 50px;">
                <h3>Access Denied</h3>
                <p>You need Admin privileges to access this page.</p>
                <button @onclick="GoHome">Go Home</button>
            </div>
        </NotAuthorized>
    </AuthorizeView>
</CascadingAuthenticationState>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const resizer = document.getElementById('resizer');
    const sidebar = document.getElementById('sidebar');

    let isResizing = false;

    resizer.addEventListener('mousedown', (e) => {
        isResizing = true;
        document.addEventListener('mousemove', resize);
        document.addEventListener('mouseup', stopResize);
    });

    function resize(e) {
        if (!isResizing) return;

        const newWidth = e.clientX;
        if (newWidth >= 200 && newWidth <= 500) {
            sidebar.style.width = newWidth + 'px';
        }
    }

    function stopResize() {
        isResizing = false;
        document.removeEventListener('mousemove', resize);
        document.removeEventListener('mouseup', stopResize);
    }
</script>

@code {
    [Parameter]
    public int ThreadId { get; set; } = 0;


    private Type? currentComponent;
    private Dictionary<string, object> componentParameters = new();


    private void GoHome()
    {
        NavigationManager.NavigateTo("/");
    }



}